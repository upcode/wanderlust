<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<head>
  <title>Globe to Map transition</title>
  <style>
  #map {
  position: relative;
}

svg {
  background: #FFF;
  pointer-events: all;
}

.zone {
  stroke-width: .5px;
  stroke-linejoin: round;
  cursor: pointer;
}

.zoneTooltip {
  position: absolute;
  display: none;
  pointer-events: none;
  background: #fff;
  padding: 3px;
  text-align: left;
  border: solid #ccc 1px;
  color: #666;
  font-size: 12px;
  font-family: sans-serif;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

.infoLabel {
  position: absolute;
  bottom: 15px;
  left: 10px;
  display: none;
  border: solid #ccc 1px;
  color: #666;
  background: #FFFFFF;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0px 0px 3px #66C2FF;
  -moz-box-shadow: 0px 0px 3px #66C2FF;
  box-shadow: 0px 0px 3px #66C2FF;
  text-align: left;
  padding: 2px;
  font-size: 12px;
  font-family: sans-serif;
  pointer-events: none;
}

.infoLabel span {
  margin: 0px 5px;
}

.mapData {
  fill: #E6E6E6;
  stroke: #ffffff;
  stroke-width: 1px;
}

.ortho {
  fill: #E6E6E6;
  stroke: #E6E6E6;
  stroke-width: 1px;
}

.mapData:hover {
  fill: #66C2FF;
}

.focused {
  fill: #FF7519;
}</style>
</head>
<body>
  <!-- start -->
  <div id="map">
    <link href="mapStyle.css" rel="stylesheet">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="metaGlobe2Map2.js"></script>
  </div>
  <!-- end -->
</body>
<script>
var mapWidth = 960,
mapHeight = 500,
focused = false,
ortho = true,
sens = 0.25;

var projectionGlobe = d3.geo.orthographic()
.scale(240)
.rotate([0, 0])
.translate([mapWidth / 2, mapHeight / 2])
.clipAngle(90);

var projectionMap = d3.geo.equirectangular()
.scale(145)
.translate([mapWidth / 2, mapHeight / 2])

var projection = projectionGlobe;

var path = d3.geo.path()
.projection(projection);

var svgMap = d3.select("div#map").append("svg")
.attr("overflow", "hidden")
.attr("width", mapWidth)
.attr("height", mapHeight);

var zoneTooltip = d3.select("div#map").append("div").attr("class", "zoneTooltip"),
infoLabel = d3.select("div#map").append("div").attr("class", "infoLabel");

var g = svgMap.append("g");

//Rotate to default before animation

function defaultRotate() {
  d3.transition()
  .duration(1500)
  .tween("rotate", function() {
    var r = d3.interpolate(projection.rotate(), [0, 0]);
    return function(t) {
      projection.rotate(r(t));
      g.selectAll("path").attr("d", path);
    };
  })
};

//Loading data
static/countries_and_states.json

queue()
.defer(d3.json, "static/world-50.json")
.defer(d3.tsv, "static/world_country_names.tsv")
.await(ready);


function ready(error, world, countryData) {

  var countryById = {},
  countries = topojson.feature(world, world.objects.countries).features;

  //Adding countries by name

  countryData.forEach(function(d) {
    countryById[d.id] = d.name;
  });

  //Drawing countries on the globe

  var world = g.selectAll("path").data(countries);
  world.enter().append("path")
  .attr("class", "mapData")
  .attr("d", path)
  .classed("ortho", ortho = true);

  //Drag event

  world.call(d3.behavior.drag()
    .origin(function() { var r = projection.rotate(); return {x: r[0] / sens, y: -r[1] / sens}; })
    .on("drag", function() {
      var λ = d3.event.x * sens,
      φ = -d3.event.y * sens,
      rotate = projection.rotate();
      //Restriction for rotating upside-down
      φ = φ > 30 ? 30 :
      φ < -30 ? -30 :
      φ;
      projection.rotate([λ, φ]);
      g.selectAll("path.ortho").attr("d", path);
      g.selectAll(".focused").classed("focused", focused = false);
    }))

  //Events processing

  world.on("mouseover", function(d) {
    if (ortho === true) {
      infoLabel.text(countryById[d.id])
      .style("display", "inline");
    } else {
      zoneTooltip.text(countryById[d.id])
      .style("left", (d3.event.pageX + 7) + "px")
      .style("top", (d3.event.pageY - 15) + "px")
      .style("display", "block");
    }
  })
  .on("mouseout", function(d) {
    if (ortho === true) {
      infoLabel.style("display", "none");
    } else {
      zoneTooltip.style("display", "none");
    }
  })
  .on("mousemove", function() {
    if (ortho === false) {
      zoneTooltip.style("left", (d3.event.pageX + 7) + "px")
      .style("top", (d3.event.pageY - 15) + "px");
    }
  })
  .on("click", function(d) {
    if (focused === d) return reset();
    g.selectAll(".focused").classed("focused", false);
    d3.select(this).classed("focused", focused = d);
    infoLabel.text(countryById[d.id])
    .style("display", "inline");

    //Transforming Globe to Map

    if (ortho === true) {
      defaultRotate();
      setTimeout(function() {
        g.selectAll(".ortho").classed("ortho", ortho = false);
        projection = projectionMap;
        path.projection(projection);
        g.selectAll("path").transition().duration(5000).attr("d", path);
      }
      , 1600);
    }
  });

  //Adding extra data when focused

  function focus(d) {
    if (focused === d) return reset();
    g.selectAll(".focused").classed("focused", false);
    d3.select(this).classed("focused", focused = d);
  }

  function reset() {
    g.selectAll(".focused").classed("focused", focused = false);
    infoLabel.style("display", "none");
    zoneTooltip.style("display", "none");

    //Transforming Map to Globe

    projection = projectionGlobe;
    path.projection(projection);
    g.selectAll("path").transition().duration(5000).attr("d", path)
    g.selectAll("path").classed("ortho", ortho = true);
  }
};

//world dictionary
id  name
var country_name_dictionary = {

4 Afghanistan
8 Albania
12  Algeria
24  Angola
10  Antarctica
32  Argentina
51  Armenia
36  Australia
40  Austria
31  Azerbaijan
44  Bahamas
50  Bangladesh
112 Belarus
56  Belgium
84  Belize
204 Benin
64  Bhutan
68  Bolivia, Plurinational State of
70  Bosnia and Herzegovina
72  Botswana
76  Brazil
96  Brunei Darussalam
100 Bulgaria
854 Burkina Faso
108 Burundi
116 Cambodia
120 Cameroon
124 Canada
140 Central African Republic
148 Chad
152 Chile
156 China
170 Colombia
178 Congo
180 Congo, the Democratic Republic of the
188 Costa Rica
384 Cote d'Ivoire
191 Croatia
192 Cuba
196 Cyprus
203 Czech Republic
208 Denmark
262 Djibouti
214 Dominican Republic
218 Ecuador
818 Egypt
222 El Salvador
226 Equatorial Guinea
232 Eritrea
233 Estonia
231 Ethiopia
238 Falkland Islands (Malvinas)
242 Fiji
246 Finland
250 France
260 French Southern Territories
266 Gabon
270 Gambia
268 Georgia
276 Germany
288 Ghana
300 Greece
304 Greenland
320 Guatemala
324 Guinea
624 Guinea-Bissau
328 Guyana
332 Haiti
340 Honduras
348 Hungary
352 Iceland
356 India
360 Indonesia
364 Iran, Islamic Republic of
368 Iraq
372 Ireland
376 Israel
380 Italy
388 Jamaica
392 Japan
400 Jordan
398 Kazakhstan
404 Kenya
408 Korea, Democratic People's Republic of
410 Korea, Republic of
414 Kuwait
417 Kyrgyzstan
418 Lao People's Democratic Republic
428 Latvia
422 Lebanon
426 Lesotho
430 Liberia
434 Libya
440 Lithuania
442 Luxembourg
807 Macedonia, the former Yugoslav Republic of
450 Madagascar
454 Malawi
458 Malaysia
466 Mali
478 Mauritania
484 Mexico
498 Moldova, Republic of
496 Mongolia
499 Montenegro
504 Morocco
508 Mozambique
104 Myanmar
516 Namibia
524 Nepal
528 Netherlands
540 New Caledonia
554 New Zealand
558 Nicaragua
562 Niger
566 Nigeria
578 Norway
512 Oman
586 Pakistan
275 Palestinian Territory, Occupied
591 Panama
598 Papua New Guinea
600 Paraguay
604 Peru
608 Philippines
616 Poland
620 Portugal
630 Puerto Rico
634 Qatar
642 Romania
643 Russian Federation
646 Rwanda
682 Saudi Arabia
686 Senegal
688 Serbia
694 Sierra Leone
703 Slovakia
705 Slovenia
90  Solomon Islands
706 Somalia
710 South Africa
728 South Sudan
724 Spain
144 Sri Lanka
729 Sudan
740 Suriname
748 Swaziland
752 Sweden
756 Switzerland
760 Syrian Arab Republic
158 Taiwan, Province of China
762 Tajikistan
834 Tanzania, United Republic of
764 Thailand
626 Timor-Leste
768 Togo
780 Trinidad and Tobago
788 Tunisia
792 Turkey
795 Turkmenistan
800 Uganda
804 Ukraine
784 United Arab Emirates
826 United Kingdom
840 United States
858 Uruguay
860 Uzbekistan
548 Vanuatu
862 Venezuela, Bolivarian Republic of
704 Viet Nam
732 Western Sahara
887 Yemen
894 Zambia
716 Zimbabwe
};


</script>
</html>
